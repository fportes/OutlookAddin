<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SummitCare Signature Generator</title>

<script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>

<style>
body { font-family: Gill Sans MT, sans-serif; padding: 30px; }
input { width: 300px; margin-bottom: 10px; padding: 6px; }
button { padding: 8px 14px; margin-top: 10px; margin-right: 5px; cursor:pointer; }
#preview { margin-top: 20px; }
</style>
</head>
<body>

<h2>SummitCare Reply Signature Generator</h2>

<button onclick="signIn()">Sign in & Load My Info</button>
<br><br>

<label>Full Name</label><br>
<input id="name"><br>

<label>Job Title</label><br>
<input id="title"><br>

<label>Direct Phone</label><br>
<input id="office"><br>

<label>Mobile Phone</label><br>
<input id="mobile"><br>

<label>Fax</label><br>
<input id="fax"><br>

<label>Email</label><br>
<input id="email"><br>

<button onclick="generate()">Generate Signature</button>
<button onclick="copySig()">Copy to Clipboard</button>

<div id="preview"></div>

<script>

const brandBlue = "#0086BE";

const msalConfig = {
  auth: {
    clientId: "7067c890-8e1d-4d4a-97f2-19494738a791",
    authority: "https://login.microsoftonline.com/2c699aee-68d5-473a-9421-43ce57598512",
    redirectUri: window.location.origin
  }
};

const msalInstance = new msal.PublicClientApplication(msalConfig);

async function signIn() {
  try {

    const loginResponse = await msalInstance.loginPopup({
      scopes: ["User.Read"]
    });

    const tokenResponse = await msalInstance.acquireTokenSilent({
      scopes: ["User.Read"],
      account: loginResponse.account
    });

    const response = await fetch(
      "https://graph.microsoft.com/v1.0/me?$select=displayName,jobTitle,mail,userPrincipalName,businessPhones,mobilePhone",
      {
        headers: { Authorization: `Bearer ${tokenResponse.accessToken}` }
      }
    );

    const user = await response.json();

    document.getElementById("name").value = user.displayName || "";
    document.getElementById("title").value = user.jobTitle || "";
    document.getElementById("office").value = (user.businessPhones && user.businessPhones.length > 0) ? user.businessPhones[0] : "";
    document.getElementById("mobile").value = user.mobilePhone || "";

  } catch (err) {
    alert("Sign-in failed: " + err.message);
    console.error(err);
  }
}

function generate() {

  const name = document.getElementById("name").value;
  const title = document.getElementById("title").value;
  const office = document.getElementById("office").value;
  const mobile = document.getElementById("mobile").value;
  const fax = document.getElementById("fax").value;

  const signature = `
  <div style="font-family:Gill Sans MT, sans-serif; font-size:12px; line-height:1.5; color:#333333;">
    
    <span style='font-size:14px; font-size:14px;'>${name}</span> |
    <span style="color:${brandBlue}; font-size:14px;"> ${title}</span><br>
    
    Summit Care Management LLC<br><br>
    
    ${office ? `<span style="color:${brandBlue};">D:</span> ${office}<br>` : ""}
    ${mobile ? `<span style="color:${brandBlue};">C:</span> ${mobile}<br>` : ""}
    ${fax ? `<span style="color:${brandBlue};">F:</span> ${fax}<br>` : ""}
    
  </div>
  `;

  document.getElementById("preview").innerHTML = signature;
}

async function copySig() {
  const preview = document.getElementById("preview");

  try {
    if (navigator.clipboard && window.isSecureContext) {

      const blob = new Blob([preview.innerHTML], { type: "text/html" });
      const data = [new ClipboardItem({ "text/html": blob })];
      await navigator.clipboard.write(data);

    } else {
      // Fallback for non-HTTPS
      const textarea = document.createElement("textarea");
      textarea.value = preview.innerHTML;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand("copy");
      document.body.removeChild(textarea);
    }

    alert("Signature copied! Go to Outlook > Settings > Accounts > Signature and paste into Reply Signature.");

  } catch (err) {
    alert("Copy failed: " + err.message);
  }
}

</script>

</body>
</html>
