<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SummitCare Signature Generator</title>

<script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>

<style>
body { font-family: Arial; padding: 30px; }
input { width: 300px; margin-bottom: 10px; padding: 6px; }
button { padding: 8px 14px; margin-top: 10px; margin-right: 5px; }
#output { margin-top: 20px; border: 1px solid #ccc; padding: 15px; }
</style>
</head>
<body>

<h2>SummitCare Reply Signature Generator</h2>

<button onclick="signIn()">Sign in & Load My Info</button>
<br><br>

<label>Full Name</label><br>
<input id="name"><br>

<label>Job Title</label><br>
<input id="title"><br>

<label>Office Phone</label><br>
<input id="office"><br>

<label>Mobile Phone</label><br>
<input id="mobile"><br>

<label>Email</label><br>
<input id="email"><br>

<button onclick="generate()">Generate Signature</button>

<div id="output"></div>
<button onclick="copySig()">Copy to Clipboard</button>

<script>

const msalConfig = {
  auth: {
    clientId: "7067c890-8e1d-4d4a-97f2-19494738a791",
    authority: "https://login.microsoftonline.com/2c699aee-68d5-473a-9421-43ce57598512",
    redirectUri: window.location.origin
  }
};

const msalInstance = new msal.PublicClientApplication(msalConfig);

async function signIn() {
  const loginResponse = await msalInstance.loginPopup({
    scopes: ["User.Read"]
  });

  const account = loginResponse.account;

  const tokenResponse = await msalInstance.acquireTokenSilent({
    scopes: ["User.Read"],
    account: account
  });

  const response = await fetch("https://graph.microsoft.com/v1.0/me", {
    headers: { Authorization: `Bearer ${tokenResponse.accessToken}` }
  });

  const user = await response.json();

  document.getElementById("name").value = user.displayName || "";
  document.getElementById("title").value = user.jobTitle || "";
  document.getElementById("email").value = user.mail || "";
  document.getElementById("office").value = user.businessPhones?.[0] || "";
  document.getElementById("mobile").value = user.mobilePhone || "";
}

function generate() {
  const name = document.getElementById("name").value;
  const title = document.getElementById("title").value;
  const office = document.getElementById("office").value;
  const mobile = document.getElementById("mobile").value;
  const email = document.getElementById("email").value;

  const signature = `
  <div style="font-family:Gill Sans MT; font-size:12px;">
    ${name} | ${title}<br>
    Summit Care Management LLC<br><br>
    ${office ? "D: " + office + "<br>" : ""}
    ${fax ? "F: " + fax + "<br>" : ""}
    ${mobile ? "M: " + mobile + "<br>" : ""}
  </div>
`;

  document.getElementById("output").innerHTML = signature;
}

function copySig() {
  const range = document.createRange();
  range.selectNode(document.getElementById("output"));
  window.getSelection().removeAllRanges();
  window.getSelection().addRange(range);
  document.execCommand("copy");
  alert("Signature copied. Paste into Outlook Reply Signature.");
}

</script>

</body>
</html>
